<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Hoher Fl√§ming Hot Air Balloon Explorer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,400;0,700;1,400&family=Work+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="index.css">
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.19.0"
  }
}
</script>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loading-content">
            <div class="loading-balloon">üéà</div>
            <div class="loading-text">Preparing for launch...</div>
            <div class="loading-bar">
                <div class="loading-bar-fill"></div>
            </div>
        </div>
    </div>

    <!-- Map Container -->
    <div id="map-container">
        <div id="map-viewport">
            <img id="map-image" src="images/map.jpg" alt="Map of Hoher Fl√§ming">
            
            <!-- Cartographic Overlays -->
            <div id="map-grid-overlay"></div>
            <div id="map-texture-overlay"></div>
            
            <!-- Balloon -->
            <div id="balloon-container">
                <div id="balloon">
                    <!-- Dynamic Shadow Element -->
                    <div id="balloon-shadow"></div>
                    
                    <!-- Visual Wrapper for Tilt Animation -->
                    <div id="balloon-visuals">
                        <!-- High-Fidelity Balloon SVG -->
                        <svg id="balloon-svg" viewBox="0 0 200 260" xmlns="http://www.w3.org/2000/svg">
                            <defs>
                                <!-- 3D Shading Gradient -->
                                <radialGradient id="balloonShade" cx="30%" cy="30%" r="70%" fx="30%" fy="30%">
                                    <stop offset="0%" stop-color="#ffffff" stop-opacity="0.4"/>
                                    <stop offset="40%" stop-color="#ffffff" stop-opacity="0.1"/>
                                    <stop offset="80%" stop-color="#000000" stop-opacity="0.1"/>
                                    <stop offset="100%" stop-color="#000000" stop-opacity="0.3"/>
                                </radialGradient>
                                
                                <!-- Basket Texture -->
                                <pattern id="wicker" x="0" y="0" width="10" height="10" patternUnits="userSpaceOnUse">
                                    <rect width="10" height="10" fill="#8d6e63"/>
                                    <path d="M0 5h10 M5 0v10" stroke="#5d4037" stroke-width="2"/>
                                </pattern>

                                <!-- Burner Flame Gradient -->
                                <linearGradient id="flameGradient" x1="0.5" y1="1" x2="0.5" y2="0">
                                    <stop offset="0%" stop-color="#ffeb3b"/> <!-- Yellow -->
                                    <stop offset="60%" stop-color="#ff9800"/> <!-- Orange -->
                                    <stop offset="100%" stop-color="#f44336" stop-opacity="0"/> <!-- Red fading out -->
                                </linearGradient>
                            </defs>

                            <!-- Ropes (Back) -->
                            <path d="M60 150 L85 210" stroke="#5d4037" stroke-width="1.5"/>
                            <path d="M140 150 L115 210" stroke="#5d4037" stroke-width="1.5"/>

                            <!-- BALLOON ENVELOPE -->
                            <g transform="translate(100, 90)">
                                <!-- Outer Panels (Black) -->
                                <path d="M0 -85 C-55 -85 -90 -40 -90 10 C-90 55 -50 85 -15 110 L15 110 C50 85 90 55 90 10 C90 -40 55 -85 0 -85 Z" fill="#151513"/>
                                
                                <!-- Mid Side Panels (Blue) -->
                                <path d="M0 -85 C-40 -85 -70 -40 -70 10 C-70 50 -35 80 -12 108 L12 108 C35 80 70 50 70 10 C70 -40 40 -85 0 -85 Z" fill="#0296c6"/>

                                <!-- Inner Side Panels (Yellow) -->
                                <path d="M0 -85 C-25 -85 -45 -40 -45 10 C-45 45 -20 75 -8 106 L8 106 C20 75 45 45 45 10 C45 -40 25 -85 0 -85 Z" fill="#f5d306"/>

                                <!-- Center Panel (Green) -->
                                <path d="M0 -85 C-10 -85 -20 -40 -20 10 C-20 40 -10 70 -4 105 L4 105 C10 70 20 40 20 10 C20 -40 10 -85 0 -85 Z" fill="#0ca644"/>
                                
                                <!-- Horizontal Band (White) -->
                                <path d="M-68 20 Q0 40 68 20 L68 5 Q0 25 -68 5 Z" fill="#ffffff" opacity="0.9" style="mix-blend-mode: overlay"/>

                                <!-- 3D Overlay -->
                                <path d="M0 -85 C-55 -85 -90 -40 -90 10 C-90 55 -50 85 -15 110 L15 110 C50 85 90 55 90 10 C90 -40 55 -85 0 -85 Z" fill="url(#balloonShade)"/>
                            </g>

                            <!-- Burner Flame (Animated) -->
                            <path class="burner-flame" d="M95 205 Q100 180 105 205 Q100 215 95 205" fill="url(#flameGradient)"/>

                            <!-- Basket Assembly -->
                            <g transform="translate(85, 210)">
                                <!-- Ropes connecting to hoop -->
                                <line x1="0" y1="0" x2="5" y2="15" stroke="#5d4037" stroke-width="2"/>
                                <line x1="30" y1="0" x2="25" y2="15" stroke="#5d4037" stroke-width="2"/>
                                
                                <!-- The Basket -->
                                <rect x="0" y="15" width="30" height="25" rx="4" fill="url(#wicker)"/>
                                <!-- Basket Rim -->
                                <rect x="-2" y="13" width="34" height="5" rx="2" fill="#4e342e"/>
                                <!-- Sandbags -->
                                <g fill="#a1887f" stroke="#4e342e" stroke-width="1">
                                    <circle cx="-2" cy="25" r="4"/>
                                    <circle cx="32" cy="25" r="4"/>
                                    <circle cx="-2" cy="32" r="4"/>
                                </g>
                            </g>
                        </svg>
                    </div>
                </div>
            </div>
        </div>
        <!-- Vignette Overlay -->
        <div id="vignette"></div>
    </div>

    <!-- HUD -->
    <div id="hud-container">
        <div class="hud-left">
            <div class="hud-panel info-panel">
                <div class="hud-row">
                    <span class="hud-label">Speed</span>
                    <span class="hud-value" id="speed-display">0.0</span>
                </div>
                <div class="hud-row">
                    <span class="hud-label">Visited</span>
                    <span class="hud-value" id="poi-count">0/16</span>
                </div>
                 <div class="hud-row">
                    <span class="hud-label">Time</span>
                    <span class="hud-value" id="time-display">00:00</span>
                </div>
            </div>
        </div>


        <div class="hud-right">
            <div class="hud-panel compass-panel">
                <div class="hud-row centered-row">
                    <span class="hud-value small" id="heading-display">0¬∞</span>
                </div>
                <div id="compass">
                    <div id="compass-rose">
                        <div class="cardinal n">N</div>
                        <div class="cardinal e">E</div>
                        <div class="cardinal s">S</div>
                        <div class="cardinal w">W</div>
                    </div>
                    <div id="compass-needle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Zoom Controls -->
    <div id="zoom-controls">
        <button class="action-button secondary" id="zoom-in" title="Zoom In">Ôºã</button>
        <button class="action-button secondary" id="zoom-out" title="Zoom Out">Ôºç</button>
    </div>

    <!-- Controls -->
    <div id="controls-container">
        <div id="joystick-container">
            <div id="joystick-base"></div>
            <div id="joystick-handle"></div>
        </div>
        
        <div class="action-buttons">
            <button class="action-button primary" id="land-button">
                <span class="icon">‚öì</span>
                <span class="label">Land</span>
            </button>
            <button class="action-button secondary" id="menu-button" title="Menu">
                <span class="icon">‚ò∞</span>
            </button>
        </div>
    </div>

    <!-- Minimap -->
    <div id="minimap">
        <canvas id="minimap-canvas"></canvas>
    </div>

    <!-- Menu -->
    <div id="menu-container">
        <div id="menu-header">
            <h2 id="menu-title">Mission Log</h2>
            <button id="menu-close">‚úï</button>
        </div>
        <div id="menu-content">
            <div class="menu-section">
                <div class="menu-section-title">Flight Statistics</div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="stat-distance">0</div>
                        <div class="stat-label">Distance (km)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-max-speed">0</div>
                        <div class="stat-label">Max Speed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-landings">0</div>
                        <div class="stat-label">Landings</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-completion">0%</div>
                        <div class="stat-label">Completion</div>
                    </div>
                </div>
            </div>
            
            <div class="menu-section">
                <div class="menu-section-title">Points of Interest</div>
                <div id="poi-list"></div>
            </div>
        </div>
    </div>

    <!-- POI Modal -->
    <div id="poi-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-icon-badge" id="modal-icon">1</div>
                <h2 id="poi-modal-title">Point of Interest</h2>
            </div>
            <div class="modal-body">
                <p class="modal-description" id="poi-modal-description"></p>
                <div class="modal-stats">
                    <div class="modal-stat">
                        <div class="modal-stat-value" id="modal-visit-time">--:--</div>
                        <div class="modal-stat-label">Visit Time</div>
                    </div>
                    <div class="modal-stat">
                        <div class="modal-stat-value" id="modal-poi-number">1/16</div>
                        <div class="modal-stat-label">Progress</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-button primary" id="continue-button">Continue Flying</button>
                <button class="modal-button secondary" id="next-poi-button">Next POI ‚Üí</button>
            </div>
        </div>
    </div>

    <!-- Completion Modal -->
    <div id="completion-modal" class="modal">
        <div class="modal-content center-text">
            <div class="modal-header vertical">
                <div class="modal-icon-large">üèÜ</div>
                <h2>Mission Complete!</h2>
            </div>
            <p class="modal-description">
                Congratulations, pilot! You've successfully explored all 16 points of interest in the Hoher Fl√§ming Nature Park.
            </p>
            <div class="modal-stats">
                <div class="modal-stat">
                    <div class="modal-stat-value" id="final-time">00:00</div>
                    <div class="modal-stat-label">Total Time</div>
                </div>
                <div class="modal-stat">
                    <div class="modal-stat-value" id="final-distance">0 km</div>
                    <div class="stat-label">Distance</div>
                </div>
                <div class="modal-stat">
                    <div class="modal-stat-value" id="final-speed">0</div>
                    <div class="stat-label">Avg Speed</div>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="modal-button primary" id="restart-button">New Mission</button>
                <button class="modal-button secondary" id="explore-button">Free Flight</button>
            </div>
        </div>
    </div>

    <!-- Achievement Toast -->
    <div id="achievement-toast" class="achievement-toast">
        <div class="toast-content">
            <span class="achievement-icon">üèÜ</span>
            <span class="achievement-text" id="achievement-text">Achievement Unlocked!</span>
        </div>
    </div>

    <script type="module" src="index.tsx"></script>
</body>
</html>